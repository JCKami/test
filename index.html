  <!-- Layer do susto -->
  <div id="scare" class="scare" aria-hidden="true">
    <h2 id="scareText">BOO!</h2>
    <p id="scareSub">Você foi pego!</p>
    <div style="margin-top:18px">
      <button class="ghost" id="muteBtn">Desativar Som</button>
      <button class="ghost" id="closeBtn">Fechar</button>
    </div>
  </div>

  <!-- Áudio de susto (som externo) -->
  <audio id="scareAudio" src="susto.mp3" preload="auto"></audio>

<script>
/*
  Single-file "jump scare" leve:
  - Pode ser ativado por clique (recomendado — navegadores exigem gesto para tocar som).
  - Também tenta ativar automaticamente após X segundos; se o áudio for bloqueado, aparece botão pra tocar som.
  - Use com responsabilidade.
*/
const startBtn = document.getElementById('startBtn');
const cancelBtn = document.getElementById('cancelBtn');
const scare = document.getElementById('scare');
const closeBtn = document.getElementById('closeBtn');
const muteBtn = document.getElementById('muteBtn');
const scareAudio = document.getElementById('scareAudio');

let autoTimer = null;
let soundEnabled = true;
let audioAllowed = false; // será verdadeiro se o áudio tocar com sucesso

// Cria um som breve (WebAudio) — ruído curto e impacto
const AudioContext = window.AudioContext || window.webkitAudioContext;
let actx = null;
function playScareSound(){
  try{
    if(!AudioContext) return false;
    if(!actx) actx = new AudioContext();
    const now = actx.currentTime;
    const bufferSize = 2 * actx.sampleRate;
    const buffer = actx.createBuffer(1, bufferSize, actx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<bufferSize;i++){
      data[i] = (Math.random()*2-1) * Math.exp(-i/(0.5*actx.sampleRate));
    }
    const noise = actx.createBufferSource();
    noise.buffer = buffer;
    const band = actx.createBiquadFilter();
    band.type = 'highpass';
    band.frequency.value = 600;
    band.Q.value = 0.7;
    const gain = actx.createGain();
    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.exponentialRampToValueAtTime(1.2, now + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.35);
    noise.connect(band);
    band.connect(gain);
    gain.connect(actx.destination);
    noise.start(now);
    noise.stop(now + 0.5);
    return true;
  }catch(e){
    return false;
  }
}

function showScare(withSoundAttempt = true){
  scare.setAttribute('aria-hidden', 'false');
  requestAnimationFrame(()=> scare.classList.add('show'));
  if(soundEnabled && withSoundAttempt){
    if(scareAudio){
      scareAudio.currentTime = 0;
      scareAudio.play().then(() => audioAllowed = true).catch(() => {});
    } else {
      const played = playScareSound();
      if(played) audioAllowed = true;
    }
  }
}

function hideScare(){
  scare.classList.remove('show');
  setTimeout(()=> scare.setAttribute('aria-hidden','true'), 300);
}

startBtn.addEventListener('click', (e)=>{
  if(autoTimer) { clearTimeout(autoTimer); autoTimer = null; }
  const ok = playScareSound();
  if(ok) audioAllowed = true;
  showScare(true);
});

cancelBtn.addEventListener('click', ()=>{
  if(autoTimer){ clearTimeout(autoTimer); autoTimer = null; alert('Surpresa cancelada.'); }
  else alert('Nenhum timer ativo — clique em "Ver a surpresa" para ver.');
});

closeBtn.addEventListener('click', hideScare);

muteBtn.addEventListener('click', ()=>{
  soundEnabled = false;
  alert('Som desativado.');
});

autoTimer = setTimeout(()=>{
  const played = playScareSound();
  if(played) audioAllowed = true;
  showScare(!played ? false : true);
  autoTimer = null;
}, 5000);

document.getElementById('scareText').textContent = 'BOO!';
document.getElementById('scareSub').textContent = 'Peguei você!';
</script>
</body>
</html>
